import time
import urllib.request
from bs4 import BeautifulSoup
import ssl
import serial
import wmi

finder="AAA"

#init beautifulsoup
ssl._create_default_https_context = ssl._create_unverified_context
user_agent = 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.7) Gecko/2009021910 Firefox/3.0.7'
url ="https://banggia.cafef.vn/stockhandler.ashx?center=undefined"
headers = {'User-Agent': user_agent, }
request = urllib.request.Request(
    url, None, headers)  

#init arduino comunication

w = wmi.WMI(namespace="root\OpenHardwareMonitor")
arduino = serial.Serial(port='COM9', baudrate=115200, timeout=.1)

def write_read(x):
    arduino.write(bytes(x, 'utf-8'))
    time.sleep(1)


#init stocks
def LookingForPrice():
	response = urllib.request.urlopen(request)
	data = response.read()  # The data u need
	soup = BeautifulSoup(data, features="html.parser")
	soup = soup.get_text()
	soup=str(soup)
	print(soup.find('AAA'))
	soup=soup.replace('"','')
	soup=soup.replace('{','')
	soup=soup.replace('}','')
	soup=soup.replace('[','')
	soup=soup.replace(']','')
	soup=soup.replace(',',' ')
	return soup
def check(finder):
	tg=soup[soup.find(finder):len(soup)]
	tg=tg[0:soup.find("2021")+2]
	price=tg[ ( tg.find("l")+2 ): ( tg.find("l") + 5 )]
	return price.replace(".","")

finderlist=['VCF', 
'RAL', 
'GAB', 
'DGC', 
'SAB', 
'MSN', 
'SCS', 
'VJC', 
'MWG', 
'GAS', 
'PTB', 
'DGW', 
'SVC', 
'NVL', 
'PNJ', 
'PDR', 
'DHG', 
'FPT', 
'HDC', 
'VCB', 
'DHC', 
'VIC', 
'VNM', 
'TRA', 
'MSH', 
'NCT', 
'THG', 
'NSC', 
'VHM', 
'SVI', 
'REE', 
'TCM', 
'DPR', 
'DPG', 
'CTD', 
'SGN', 
'HAH', 
'VPG', 
'VSC', 
'TMS', 
'GIL', 
'HDG', 
'BVH', 
'HTN', 
'D2D', 
'VHC', 
'BHN', 
'SZC', 
'DVP', 
'VCI', 
'CMG', 
'CAV', 
'SJS', 
'FTS', 
'SZL', 
'TAC', 
'STK', 
'DBC', 
'DMC', 
'PHR', 
'GDT', 
'KDC', 
'OPC', 
'TV2', 
'SFI', 
'LIX', 
'UIC', 
'HPG', 
'LHG', 
'AST', 
'NLG', 
'HRC', 
'BMP', 
'DHA', 
'NKG', 
'PLX', 
'VFG', 
'SMC', 
'TCB', 
'VND', 
'GMD', 
'TMP', 
'AGG', 
'FMC', 
'HSG', 
'BCM', 
'DBD', 
'FRT', 
'CSV', 
'TIP', 
'TRC', 
'KDH', 
'ADG', 
'DPM', 
'DSN', 
'TNH', 
'NTL', 
'BMI', 
'KBC', 
'BWE', 
'DIG', 
'TLG', 
'VPI', 
'TPB', 
'APH', 
'NHA', 
'SMB', 
'PC1', 
'FIR', 
'VCG', 
'PAC', 
'TCL', 
'BID', 
'SSI', 
'KSB', 
'NHH', 
'GVR', 
'TN1', 
'VMD', 
'NBB', 
'DTL', 
'TDW', 
'VGC', 
'HCM', 
'PGD', 
'VPB', 
'C32', 
'BFC', 
'VIB', 
'SSB', 
'DCL', 
'CNG', 
'CLC', 
'AGM', 
'TCT', 
'TNC', 
'ILB', 
'CLL', 
'TIX', 
'ADS', 
'TCD', 
'TDM', 
'KOS', 
'VDS', 
'DRC', 
'IJC', 
'DCM', 
'ANV', 
'HMC', 
'HPX', 
'ACB', 
'TVS', 
'TVT', 
'CRE', 
'PET', 
'VRE', 
'PAN', 
'TBC', 
'BIC', 
'DXS', 
'VSH', 
'S4A', 
'NNC', 
'SGT', 
'CTG', 
'ASG', 
'THI', 
'HUB', 
'MCP', 
'MIG', 
'PGC', 
'NAF', 
'VNL', 
'PVD', 
'ELC', 
'SAV', 
'MBB', 
'PGI', 
'SHP', 
'SHB', 
'BMC', 
'CTS', 
'SFC', 
'OCB', 
'TDC', 
'TCO', 
'CKG', 
'GMC', 
'SGR', 
'STB', 
'TGG', 
'HVN', 
'STG', 
'GEX', 
'PVT', 
'HT1', 
'HDB', 
'ITD', 
'DQC', 
'L10', 
'HAX', 
'NT2', 
'TLH', 
'BCG', 
'EIB', 
'TVB', 
'SC5', 
'SJD', 
'MSB', 
'PPC', 
'ITC', 
'DXG', 
'APC', 
'ICT', 
'VOS', 
'DTA', 
'IBC', 
'LAF', 
'VIX', 
'CCI', 
'PSH', 
'SBT', 
'SPM', 
'GEG', 
'LPB', 
'SRC', 
'CHP', 
'CII', 
'CTF', 
'HTL', 
'SKG', 
'DC4', 
'SBA', 
'TYA', 
'GTN', 
'SAM', 
'VIS', 
'AAT', 
'ABS', 
'HTI', 
'RIC', 
'ACC', 
'DRH', 
'EVE', 
'SCD', 
'HII', 
'CTI', 
'VPD', 
'ASM', 
'SHI', 
'SII', 
'CSM', 
'VCA', 
'BCE', 
'DBT', 
'POM', 
'APG', 
'VRC', 
'LCG', 
'HBC', 
'CCL', 
'TCH', 
'BTP', 
'AGR', 
'FCN', 
'TTA', 
'PMG', 
'CDC', 
'GTA', 
'YEG', 
'BRC', 
'GSP', 
'SBV', 
'AAA', 
'SFG', 
'HAP', 
'VAF', 
'SVT', 
'CMX', 
'PHC', 
'TNA', 
'HTV', 
'VPS', 
'TEG', 
'KPF', 
'KHG', 
'PLP', 
'SCR', 
'FDC', 
'HHP', 
'DHM', 
'ASP', 
'LSS', 
'VTO', 
'VIP', 
'VNG', 
'ACL', 
'C47', 
'MHC', 
'TMT', 
'HCD', 
'RDP', 
'SRF', 
'EVG', 
'PJT', 
'FIT', 
'LEC', 
'HU1', 
'POW', 
'FLC', 
'SMA', 
'VTB', 
'CRC', 
'PTC', 
'TSC', 
'VID', 
'ST8', 
'SVD', 
'HVH', 
'BKG', 
'TNT', 
'VNE', 
'PNC', 
'NVT', 
'TDG', 
'HID', 
'TTF', 
'YBM', 
'QCG', 
'LDG', 
'DAH', 
'HSL', 
'LGL', 
'TTB', 
'FCM', 
'SHA', 
'SJF', 
'PTL', 
'HVX', 
'VPH', 
'TLD', 
'ITA', 
'KMR', 
'HU3', 
'HHS', 
'HAR', 
'UDC', 
'KHP', 
'IDI', 
'HNG', 
'PXS', 
'DLG', 
'OGC', 
'JVC', 
'PIT', 
'DAG', 
'DXV', 
'MCG', 
'FTM', 
'ROS', 
'TNI', 
'AMD', 
'HAG', 
'HAI', 
'QBS', 
'HQC', 
'TCR', 
'PXI'
]
write_read(finder)
#main loop
while True:
	temperature_infos = w.Sensor()
	soup=LookingForPrice()
	for finder in finderlist:
		write_read(finder+"  "+check(finder))
		print(finder+check(finder))
		time.sleep(3)
